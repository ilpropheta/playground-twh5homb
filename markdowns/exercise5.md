# A functional touch

Post-modern C++ programmers master more than one paradigm and, without a doubt, **functional paradigm** is one.

We cannot really cover functional programming in C++, it would need more than a workshop! However, we could introduce a few interesting concepts and try them out.

## Lambdas, lambdas everywhere

![Lambdas, lambdas everywhere](lambdas.png)

C++11 introduced **lambda expressions** (often called **lambdas**) that are, basically, **nested anonymous functions**:

* nested because you generally create them inside another function,
* anonymous because their type and name is automatically generated by the compiler.

Typically, lambdas are used to encapsulate a few lines of code that are passed to algorithms or asynchronous methods:

```cpp
vector<int> v = {10, 20, 30, 41, 50, 67};
auto firstOdd = std::find(begin(v), end(v), [](int i) { return i%2 == 1; });
```

This `[](int i) { return i%2 == 1; }` introduces a lambda expression.

C++ lambdas come with some details to master. I'll show you the most important ones and leave the others to further readings.

### What's a lambda, in short

### Parameter list

Just as ordinary functions, a lambda can accept input parameters:

```cpp
auto l = [](int i) { return i%2 == 1; };
```

From C++14 we can leave the compiler deduce parameters automatically (adopting templates deduction rules):

```cpp
auto l = [](auto i) { cout << i << "\n"; };
```

The parameter list is optional when the lambda is parameterless:

```cpp
auto l = [] { cout << "hello" << "\n"; };
```

### Lambda capture

### Return type

### How to hold and pass lambdas around?

- parlare anche di std::function

Continue Reading:

* Up to C++11 but a very good start: [Lambda Functions in C++11 - the Definitive Guide](https://www.cprogramming.com/c++11/c++11-lambda-closures.html)
* [Microsoft on Lambda Expressions in C++](https://docs.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp)
* Arne Mertz: [Part 1](https://arne-mertz.de/2015/10/new-c-features-lambdas/) and [Part 2](https://arne-mertz.de/2015/11/lambdas-part-2-capture-lists-and-stateful-closures/)

## Hands on!

@[Implement a visit function in our service]({"stubs": [ 
	 "microurl/src/ver6/MicroUrlService.h",
	 "microurl/src/ver6/tests/VisitTest.cpp",
	],
	"command": "sh /project/target/run_test.sh ver6 [visit]"})

## Bonus: passing stateful visitors

The functional touch you have added to our service has impressed many developers. One guy implemented a visitor to find the most popular url that our users feed MicroUrl with. Although the logic seems correct, the test he wrote is not passing.

Can you help him?

@[Fix the test]({"stubs": [ 
	 "microurl/src/ver6/MicroUrlService.h",
	 "microurl/src/ver6/tests/StatefulVisitTest.cpp",
	],
	"command": "sh /project/target/run_test.sh ver6 [stateful]"})
	
::: Do you really give up? :(

Range-based for loop combined with structure bindings (what a pity, we cannot express that `id` is unused)...

```cpp
template<typename Action>
void MicroUrlService::VisitMicroUrls(Action action) const
{
	for (auto&[id, url] : m_idToUrl)
		action(url);
}
```
:::